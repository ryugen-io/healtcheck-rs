name: Docs Validation

on:
  push:
    branches: [ master, main ]
    paths:
      - '**.md'
  pull_request:
    branches: [ master, main ]
    paths:
      - '**.md'

jobs:
  check-readme-commit:
    name: Verify README commit reference
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 2  # Need current and previous commit

      - name: Get current commit hash
        id: current
        run: echo "hash=$(git rev-parse --short HEAD)" >> $GITHUB_OUTPUT

      - name: Get previous commit hash
        id: previous
        run: echo "hash=$(git rev-parse --short HEAD^)" >> $GITHUB_OUTPUT

      - name: Check if README contains current or previous commit
        run: |
          CURRENT_HASH="${{ steps.current.outputs.hash }}"
          PREVIOUS_HASH="${{ steps.previous.outputs.hash }}"

          echo "Current commit: $CURRENT_HASH"
          echo "Previous commit: $PREVIOUS_HASH"

          if grep -q "$CURRENT_HASH" README.md; then
            echo "✓ README.md contains current commit hash: $CURRENT_HASH"
            exit 0
          elif grep -q "$PREVIOUS_HASH" README.md; then
            echo "✓ README.md contains previous commit hash: $PREVIOUS_HASH"
            exit 0
          else
            echo "✗ ZONK! README.md does not contain current ($CURRENT_HASH) or previous ($PREVIOUS_HASH) commit hash"
            echo ""
            echo "Please add a commit reference to README.md, for example:"
            echo "<!-- Last updated: $CURRENT_HASH -->"
            exit 1
          fi
